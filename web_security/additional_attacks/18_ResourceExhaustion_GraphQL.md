# サービス妨害（リソース枯渇）– GraphQL / Bulk API

## 概要
GraphQL やバルク API は 1 リクエストで大量データ取得・複雑演算が可能なため、深いネストやリカーシブクエリを用いてサーバ CPU/MEM を枯渇させる DoS 攻撃が成立する。

## 攻撃手法
1. **深度無制限クエリ**：自己参照型スキーマで深さ 100+ のネストを要求。  
2. **大量エイリアス**：同一フィールドを 1,000 回以上リクエストし、重複演算を強要。  
3. **複雑フィルタ**：正規表現や全文検索オペレータで CPU 使用率を急増させる。

## 影響
・Web/API サーバが 100% CPU・OOM Kill  
・同居サービスまで巻き添えで障害  
・クラウドコスト急増、SLA 違反

## 防御策
1. **クエリ深度制限**：graphql-depth-limit ミドルウェアでデフォルト深度を 5〜10 に。  
2. **複雑度計算 (cost analysis)**：フィールドごとに cost を設定し、合計が閾値超過で拒否。  
3. **Rate Limit / タイムアウト**：IP やアクセストークン単位で秒間リクエスト数制限、バックエンド DB へタイムアウト値をプロパゲート。  
4. **バッチ API** にはペイロードサイズ上限とページネーションを併用。

## 参考
・Apollo Server Validation Rules  
・OWASP GraphQL Security Cheat Sheet  
