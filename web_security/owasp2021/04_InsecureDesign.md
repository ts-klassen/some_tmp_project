# OWASP Top 10 2021 – A04 Insecure Design

## 概要
要件定義・設計段階でセキュリティ要件や脅威モデルを十分に考慮していないために、根本的な欠陥を抱えたシステムデザインとなること。

## 典型パターン
### 1. セキュリティ要件の欠落
「認可」「監査ログ」などが仕様書に存在しない。

### 2. 一括アップロード + 自動公開
アップロードファイルの MIME/type 検証が設計に盛り込まれておらず、RCE を許す。

### 3. 信用境界が不明確
外部サービスとの通信で入力検証ポリシーが未定義。

## 影響
- 実装後に対処困難・コスト高
- 複数脆弱性の温床となりやすい

## セキュア設計 / 実装ガイド
1. **Threat Modeling** をスプリント初期で実施（STRIDE, LINDDUN 等）。
2. セキュリティ要件を user story / acceptance criteria に組み込む。
3. DFD (Data Flow Diagram) で信用境界・データ分類を明示。
4. セキュリティ専門レビュー (Arch Review) をリリース前ゲートに設定。

## フロントエンド開発者の観点
- コンポーネント境界での入力/出力制約を型システム (TypeScript) で明示。
- クライアントサイドストレージ (LocalStorage 等) の扱いポリシーを決める。

## バックエンド開発者の観点
- セッション管理方式、パスワード復旧フロー、権限マトリクスを設計書に含める。
- API 仕様書 (OpenAPI) に認可スキーマを含め、doc と実装の乖離を防止。

## 参考資料
- OWASP Threat Modeling Cheat Sheet
- Microsoft SDL Threat Modeling Tool
- IPA「安全なウェブサイトの作り方」設計編
